<!DOCTYPE html>
<html lang="pt-br">
<style>
    * {
        top: 0;
    }
</style>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>PiraTour |  Estatísticas</title>

    <script src="./js/sessao.js"></script>
    <script src="js/scriptLogin.js"></script>
    <script src="js/scripit_perfil.js"></script>
    <script src="js/pontos_turisticos.js"></script>

    <!-- mapa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- mapa -->

    <link rel="icon" href="./assets/pirajulogo.PNG" />
    <link rel="stylesheet" href="./css/style_header.css">
    <link rel="stylesheet" href="./css/style_logado.css">
    <link rel="stylesheet" href="./css/Style_entrar-cadastrar.css">
    <link rel="stylesheet" href="./css/style_pontos_turisticos.css">
    <link rel="stylesheet" href="./css/style_corpo.css">
    <link rel="stylesheet" href="./css/style_rodape.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <link rel="stylesheet" href="./css/style.css" />

    <!-- <link rel="preconnect" href="https://fonts.gstatic.com" /> -->
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet" />

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>
<!-- header -->
<header>
    <ul class="ul_header">

        <li class="li_header_img"><a class="a_header" href="#"><img src="./assets/pirajulogo.PNG" width="130px"></a>
        </li>

        <li class="li_header2"><a class="a_header" href="Home_logado.html">SOBRE PIRAJU</a></li>

        <li class="li_header2"><a class="a_header" href="PT_logado.html">PONTOS TURÍSTICOS</a></li>

        <li class="li_header2"><a class="a_header" href="ver_avaliacoes.html">ESTATÍSTICAS</a></li>

        <!-- <li class="li_header"><a class="a_header" href="#"> EXPERIÊNCIAS</a></li> -->

        <li><a class="a_header" href="#">
                <div><i id="user_header" onclick="menu_perfil()" class='bx bxs-user-circle'></i>
            </a></li>

    </ul>
</header>
<!-- header -->

<!-- div perfil -->
<div class="box_perfil_menu">
    <div class="perfil_menu" id="div_perfil_menu">
        <ul>
            <!-- <li class="li_perfil_icone"><a class="a_icone_perfil" href="#">Meu perfil</a></li><br> -->
            <li class="li_perfil_icone"><a class="a_icone_perfil" href="./index.html">Sair <i
                        class='bx bx-log-out'></i></a>
            </li>
        </ul>
    </div>
</div>
<!-- div perfil -->

<!-- corpo  -->

<body class="body">
    <div class="corpo1">
        <div class="container_corpo">
            <div class="box_titulo">
                <div class="corpo_titulo5">
                    <div class="corpo_titulo5">Olá <B><span id="b_usuario"></B></span>,
                    </div>
                </div>
            </div>
            <div class="corpo_txt">
                <div class="corpo_txt_center">
                    <center>
                        Aqui você poderá ver de maneira geral todos os dados e estatísticas do nosso site, juntamente a
                        avaliação de todos os Pontos Turísticos !
                    </center>
                </div>
            </div>
        </div>
    </div>

    <div class="corpo1">
        <div class="corpo_txt">
            <center>
                <div class="chartfundo">
                    <div class="corpo_titulo6"> Já visitou Piraju </div>
                    <div class="grafico">
                        <canvas id="myPieChart" width="200" height="200"></canvas>
                    </div>

                    <!-- grafio -->
                </div>
            </center>
        </div>
    </div>
    </div>

    <div class="corpo1">
        <div class="corpo_txt">
            <center>
                <div class="chartfundo">
                    <div class="corpo_titulo6"> Nota Geral</div>

                    <div class="grafico">
                        <canvas id="myBarChart" width="400" height="400"></canvas>
                    </div>
                    <!-- grafico -->
                </div>

        </div>
        </center>
    </div>
    </div>
    </div>

    <div class="corpo1">
        <div class="corpo_txt">
            <center>
                <div class="chartfundo">
                    <div class="corpo_titulo6">Comentários</div>

                    <div class="grafico">
                        <canvas id="myBarAvaliacao" width="400" height="400"></canvas>
                    </div>
                    <!-- grafico -->
                </div>

        </div>
        </center>
    </div>
    </div>
    </div>
</body>
<!-- corpo -->

<!--footer inicio-->
<div class="rodape">

    <div class="navegacao_img">
        <p> <img src="./assets/pirajulogo.PNG" width="130px"></p>
    </div>

    <div class="navegacao">
        <p class="titulo_navegacao">Navegação</p>
        <a class="a_navegacao" href="Home_logado.html">SOBRE PIRAJU</a><br>
        <a class="a_navegacao" href="PT_logado.html">PONTOS TURÍSTICOS</a><br>
        <a class="a_navegacao" href="ver_avaliacoes.html">ESTATÍSTICAS</a><br>
        <!-- <a class="a_navegacao" href="#">EXPERIÊNCIAS</a><br> -->
        <!-- <a class="a_navegacao" href="#">ENTRAR</a><br> -->
        <!-- <a class="a_navegacao" href="#">CADASTRE-SE</a><br> -->
        <a class="a_navegacao" href="index.html">SAIR</a><br>
    </div>


    <div class="navegacao">
        <p class="titulo_navegacao">Todos os direitos reservados</p>
        <p>PiraTour,2023</p>
    </div>

    <div class="redes_sociais">

        <ul class="ul_rodape">
            <li class="li_rodape"> <a href="https://outlook.office.com/mail/"
                    target="https://outlook.office.com/mail/"><i class='bx bx-envelope'></i></a>
            <li class="li_rodape"><a href="https://www.instagram.com/gustavo__bueno__/"
                    target="https://www.instagram.com/gustavo__bueno__/"><i class='bx bxl-instagram'
                        id="instagram"></i></a>
            <li class="li_rodape"><a href="https://github.com/buenofonsecag/prejetooo"
                    target="https://github.com/buenofonsecag/prejetooo"><i class='bx bxl-github'></i></a>
            <li class="li_rodape"><a href=" https://wa.me/5511933923464" target=" https://wa.me/5511933923464"><i
                        class='bx bxl-whatsapp'></i></a>
            </li>
        </ul>
    </div>
</div>

<!--footer fim-->
<!-- grafico ja visitou Piraju -->
<script>
        window.onload = grafico_nota();
        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    // Dados para o gráfico
    var data = {
        labels: ["Sim", "Não"],
        datasets: [{
            data: [30, 70],
            backgroundColor: ["#36A2EB", "#FFCE56"]
        }]
    };

    // Configuração do gráfico
    var options = {
        title: {
            display: true,
        }
    };

    // Obtenha o contexto do canvas
    var ctx = document.getElementById("myPieChart").getContext("2d");

    // Crie o gráfico de pizza
    var myPieChart = new Chart(ctx, {
        type: 'pie',
        data: data,
        options: options
    });
</script>
<!-- grafico ja visitou Piraju -->

<!-- grefico notas -->
<script>
    window.onload = grafico_nota();

    function grafico_nota() {
        // Dados para o gráfico
        var data = {
            labels: ["1", "2", "3", "4", "5"],
            datasets: [{
                label: "Nota",
                data: [1, 1, 0, 4, 10],
                backgroundColor: ["#36A2EB", "#36A2EB", "#36A2EB", "#36A2EB", "#36A2EB"]
            }]
        };

        // Configuração do gráfico
        var options = {
            title: {
                display: true,
                text: "Contagem de Votos por Nota"
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        };
    }

    // Obtenha o contexto do canvas
    var ctx = document.getElementById("myBarChart").getContext("2d");

    // Crie o gráfico de barras
    var myBarChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: options
    });
</script>
<!-- grefico notas -->

<!-- grafico avaliacoes -->
<script>
  function plotarGrafico(resposta, idAquario) {
  console.log('Iniciando plotagem do gráfico...');

  let labels = [];
  let dados = {
    labels: labels,
    datasets: [
      {
        label: 'Sim',
        data: [],
        fill: false,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
      },
      {
        label: 'Não',
        data: [],
        fill: false,
        borderColor: 'rgb(199, 52, 52)',
        tension: 0.1
      }
    ]
  };

  console.log('Dados recebidos:');
  console.log(resposta);

  for (let i = 0; i < resposta.length; i++) {
    let registro = resposta[i];
    labels.push(registro.momento_grafico);
    dados.datasets[0].data.push(registro.umidade);
    dados.datasets[1].data.push(registro.temperatura);
  }

  console.log('Dados a serem plotados:');
  console.log('Labels:', labels);
  console.log('Dados:', dados.datasets);

  const config = {
    type: 'line',
    data: dados,
  };

  let myChart = new Chart(
    document.getElementById(`myChartCanvas${idAquario}`),
    config
  );

  setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
}

function atualizarGrafico(idAquario, dados, myChart) {
  fetch(`/medidas/tempo-real/${idAquario}`, { cache: 'no-store' }).then(function (response) {
    if (response.ok) {
      response.json().then(function (novoRegistro) {
        console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

        let avisoCaptura = document.getElementById(`avisoCaptura${idAquario}`);
        avisoCaptura.innerHTML = "";

        if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
          console.log("Não há dados novos para captura, o gráfico não será atualizado.");
          avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará.";
        } else {
          dados.labels.shift();
          dados.labels.push(novoRegistro[0].momento_grafico);

          dados.datasets[0].data.shift();
          dados.datasets[0].data.push(novoRegistro[0].umidade);

          dados.datasets[1].data.shift();
          dados.datasets[1].data.push(novoRegistro[0].temperatura);

          myChart.update();
        }

        setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
      });
    } else {
      console.error('Nenhum dado encontrado ou erro na API');
      setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    }
  })
  .catch(function (error) {
    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
  });
}
